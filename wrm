#!/usr/bin/env rc

if(! ~ $#* 2){
	echo 'wrm OUT IN' >[1=2]
	exit 1
}

tail -f $1 &

tp=$apid

fn die{
	kill $tp
	exit 2
}

fn sigint{ die }; fn sighup{ die }; fn sigalrm{ die }; fn sigfpe{ die }; fn sigkill { die }; fn sigterm{ die }

while(true){
	echo -n '= '
	l=`{read}
	if(test -n $l){
		echo $l | sed 's/^/self: /' >> $1
		echo $l >$2
	}
	if(test -z $l)
		die
}
