#!/usr/bin/env rc
#changed copy, copies only the files modified after FILE

if(! ~ $#* '3' || ! test -f $1 || ! test -d $2 || ! test -d $3){
	echo 'cgdc FILE DIR DEST' >[1=2]
	exit 1
}

ifs='
'

files=`{mktemp /tmp/filesXXXXXX.tmp}
newer=`{mktemp /tmp/newerXXXXXX.tmp}

fmod=`{stat --format'=%Y' $1}

find $2 -type f >$files
stat --format'=%Y %n' `{cat $files} |
awk '$1>'$fmod' { sub($1 " ", "", $0); print($0) }' >>$newer

for(i in `{cat $newer}){
	dir=`{dirname $i}
	base=`{basename $i}
	mkdir -p $3/$dir
	cp -a $i $3/$dir/$base
}

rm $newer $files
