#!/usr/bin/env rc

switch($#*){
case '0'
	cutoff=''
case '1'
	cutoff=$1
case *
	echo 'plng [cutoff]' >[2=1]
	exit 1
}

ae=''
pbs=''
oggproc=`{ps -A | grep 'ogg123' | field 1}
pbs=`{test -S /tmp/sad-sock && echo 'status playback' | nc -N -U /tmp/sad-sock | awk '{ print($2) }'}

if(! ~ $oggproc ''){
	cd /proc/$oggproc/fd;
	readlink * |
	sed -n '/\.ogg$/s/\.ogg$//p' |
	xargs basename |
	ell 42
	ae='1'
}
if(! ~ $pbs '' && ! ~ $pbs 'stop' && ! ~ $pbs 'pause' && ! ~ $ae '1'){
	id=`{echo 'status songid' | nc -N -U /tmp/sad-sock | awk 'NR==1 { print($2) }'}
	echo 'playlist' |
	nc -N -U /tmp/sad-sock |
	awk ' /^'$id':/ { gsub(".ogg$", ""); gsub("(/[^/]+)+/", "", $2); print($2) }' |
	{test $cutoff && ell $cutoff || cat}
	ae='1'
}
if(! ~ $ae '1')
	echo nothing
