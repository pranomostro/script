#!/usr/bin/env rc

if(test -z $"*){
	echo 'ircjoin SERVER:CHANNEL[:CHANNEL]' >[1=2]
	exit 1
}

for(i){
	server=`{echo $i | cut -d: -f 1}
	port=`{echo $i | cut -d: -f 2}
	crypt=`{echo $i | cut -d: -f 3}

	ii -s $server -n pranomostro `{test $port && printf '-p %s' $port} `{test $crypt && printf '-e %s' $crypt} &

	sleep 1

	ifs=':'
	for(c in `{echo $i | cut -d: -f 4- | tr -d '\n'})
		echo '/j '$c '> irc/'$server'/in'
	ifs='
'
}

sleep 1

tail -f `{echo $* | tr ' ' '\n' | awk -F: '{ for(i=4; i<=NF; i++) print("irc/" $1 "/" $i "/out") }'}
