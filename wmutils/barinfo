#!/usr/bin/env rc
#TODO: make this use less RAM.

sep=' |  '

while(true){
	echo -n ' brightness:' `{cat /sys/class/backlight/radeon_bl0/brightness} $sep
	echo -n 'battery:' `{acpi | field 4 | sed 's/,$//'} $sep
	echo -n 'date:' `{date +'%Y-%m-%d'} $sep
	echo -n 'time:' `{date +'%H:%M:%S'} $sep
	echo -n 'metrictime:' `{echo '('`{date +'%H'}'*3600+' `{date +'%M'}'*60+' `{date +'%S'} ')/86.4' | bc} $sep
	echo -n 'usedram:' `{free -h | sed '1d; $d' | field 3} $sep
	echo -n 'load:' `{cat /proc/loadavg | field 1} $ sep
	echo 'play:' `{
		cd /proc/`{
			ps -A |
			grep 'ogg123' |
			field 1
		}^/fd;
		readlink * |
		grep '^/mnt/mus' |
		sed 's/^\/mnt\/mus\/[^\/]\+\///' |
		sed 's/\.flac$//' |
		sed 's/\(.................................\).*/\1.../'
	}
	sleep 0.3
}
