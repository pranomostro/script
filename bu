#!/usr/bin/env rc

cd /mnt/backup

name=`{date +'%Y%m%d'.tar.gz}
last=`{stat --format'=%Y %n' * | sort -n | sed -n '$s/[0-9]\+ //; $p'}

if(test -f $name || test -d /mnt/backup/tmp)
	exit 0

mkdir tmp

if(~ `{date +'%d'} '01')
	cp -r /home/adrian/* /home/adrian/.* tmp
if not
	cgdc $last /home/adrian tmp

test -f tmp/home/adrian/.gnupg/random_seed && rm tmp/home/adrian/.gnupg/random_seed
test -f tmp/.gnupg/random_seed && rm tmp/.gnupg/random_seed

tar -czf $name tmp/
chmod 0600 $name
rm -rf tmp
